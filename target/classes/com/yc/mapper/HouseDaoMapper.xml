<?xml version="1.0" encoding="UTF-8" ?><!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.yc.mapper.HouseDaoMapper">
	<!-- 使用默认的mybatis配置  二级缓存 -->
	<cache eviction="FIFO" flushInterval="60000" size="512" readOnly="true"></cache>
	
	<insert id="addHouse" parameterType="House" keyProperty="id" useGeneratedKeys="true">
		insert into house(USER_ID,TYPE_ID,TITLE,DESCRIPTION,PRICE,PUBDATE,FLOORAGE,CONTACT,STREET_ID)
		values(#{users.id},#{houseType.id},#{title},#{description},#{price},now(),#{floorage},#{contact},#{street.id})	
	</insert>
	
	<update id="updateHouse" parameterType="House">
		update house set user_id=#{users.id},type_id=#{houseType.id},title=#{title},description=#{description},price=#{price},pubdate=now(),floorage=#{floorage},contact=#{contact},street_id=#{street.id}
		where id = #{id}
	</update>
	
	<!-- 根据id查房屋 -->
	<select id="findByid" parameterType="House" resultType="House">
		select * from house where id=#{id}
	</select>
	
	<delete id="delHouse">
		delete from house where id =#{id}
	</delete>
	
	<!-- 删除多条信息 -->
	<delete id="delMoreHouse" parameterType="House">
		delete from house where id in
		<foreach collection="list" open="(" close=")" separator="," item="house">
			#{id}
		</foreach>
	</delete>
	
	<select id="selectlistHouse" resultType="House">
		select * from house
	</select>
	

	
	
	
	<resultMap type="House" id="houseMap">
		<id property="id" column="id"/>
		<result property="title" column="title"/>
		<result property="description" column="description"/>
		<result property="price" column="price"/>
		<result property="pubdate" column="pubdate"/>
		<result property="floorage" column="floorage"/>
		<result property="contact" column="contact"/>
		<association property="users" resultMap="usersMap"></association>
		<association property="houseType" resultMap="houseTypeMap"></association>
		<association property="street" resultMap="streetMap"></association>
	</resultMap>
	<resultMap type="Users" id="usersMap">
		<result property="id" column="user_id"/>
		<result property="name" column="name"/>
		<result property="password" column="password"/>
		<result property="telephone" column="telephone"/>
		<result property="username" column="username"/>
		<result property="isadmin" column="isadmin"/>
	</resultMap>
	<resultMap type="HouseType" id="houseTypeMap">
		<result property="id" column="type_id"/>
		<result property="name" column="name"/>
	</resultMap>
	<resultMap type="Street" id="streetMap">
		<result property="id" column="street_id"/>
		<result property="name" column="name"/>
	</resultMap>
	
	<!-- 查询条件,分页,排序    查询 -->
	<select id="selectHouseCondition" parameterType="map" resultMap="houseMap">
		select * <include refid="conditionSql"/> <include refid="orderSql"/> <include refid="pageSql" />
	</select>
	
	<!-- 查询条件统计查询 -->
	<select id="selectHouseConditionCount" parameterType="map" resultType="int">
		select count(1) <include refid="conditionSql"/>
	</select>
	
	<!-- 可用拼接   1.查询条件-->
	<sql id="conditionSql">
		from house
		<where>
			<if test="title !=null and title !=''">
				title like '%#{title}%'
			</if>
			<if test="minPrice !=null and maxPrice!=null">
				and (price between #{minPrice} and #{maxPrice})
			</if>
			<if test="minFloorages !=null and maxFloorages!=null">
				and (floorage between #{minFloorages} and #{maxFloorages})
			</if>
			<if test="typeId !=null and typeId !=''" >
				and type_id = #{typeId}
			</if>
			<if test="districtId != null and districtId !=''">
				and district_id = #{districtId}
			</if>
			<if test="id!=null and id!=''">
				and id=#{id}
			</if>
		</where>
	</sql>
	<!-- 可用拼接   2.排序部分-->
	<sql id="orderSql">
		<if test="orderby != null and orderby!=''">
			order by #{orderby} 
			<if test="orderway!=null and orderway!=''">
				#{orderway} 
			</if>
		</if>
	</sql>
	<!-- 可用拼接   3.分页-->
	<sql id="pageSql">
		<if test="start!=null">
			limit #{start},#{pagesize}
		</if>
	</sql>
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
</mapper>